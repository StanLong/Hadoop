# 用户行为数据采集

## Flume拦截器



## 日志采集Flume

![](./doc/02.png)

日志采集Flume配置文件

```shell
[root@node01 conf]# pwd
/opt/stanlong/flume/apache-flume-1.9.0-bin/conf
[root@node01 conf]# vi file-flume-kafka.conf
```

```properties
# 定义组件
a1.sources=r1
a1.channels=c1 c2

# 配置 source
a1.sources.r1.type = TAILDIR
a1.sources.r1.positionFile = /opt/stanlong/flume/tmp/taildir_position.json
a1.sources.r1.filegroups = f1
a1.sources.r1.filegroups.f1 = /opt/stanlong/applog/log/app.+
a1.sources.r1.fileHeader = true

# 配置拦截器
a1.sources.r1.interceptors =  i1 i2
a1.sources.r1.interceptors.i1.type = com.stanlong.flume.interceptor.LogETLInterceptor$Builder
a1.sources.r1.interceptors.i2.type = com.stanlong.flume.interceptor.LogTypeInterceptor$Builder

# 配置 channel
a1.channels.c1.type = org.apache.flume.channel.kafka.KafkaChannel
a1.channels.c1.kafka.bootstrap.servers = node01:9092,node02:9092,node03:9092:node04:9092
a1.channels.c1.kafka.topic = topic-start
a1.channels.c1.parseAsFlumeEvent = false
a1.channels.c1.kafka.consumer.group.id = flume-consumer

a1.channels.c2.type = org.apache.flume.channel.kafka.KafkaChannel
a1.channels.c2.kafka.bootstrap.servers = node01:9092,node02:9092,node03:9092:node04:9092
a1.channels.c2.kafka.topic = topic-event
a1.channels.c2.parseAsFlumeEvent = false
a1.channels.c2.kafka.consumer.group.id = flume-consumer

# 拼接组件
a1.sources.r1.channels = c1 c2
```





## 日志消费Flume

![](./doc/03.png)

日志采集Flume配置文件